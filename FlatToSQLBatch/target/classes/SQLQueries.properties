retrieve_database_date_query=SELECT CURRENT TIMESTAMP FROM SYSIBM.SYSDUMMY1

#### SQL For Building FSPIN1 file batch ################

# save for use later select_ssbm_runDate= SELECT T1.JOB_RUN_DT FROM ##db-schema-name##.TWNNMDS_JOB_DTLS T1 WHERE T1.JOB_ID = 'POOUTLOG' AND T1.JOB_STATUS = 'U' ORDER BY T1.JOB_RUN_DT ASC FETCH FIRST 2 ROWS ONLY WITH UR   
#select_ssbm_runDate_popres=SELECT T1.JOB_RUN_DT FROM ##db-schema-name##.TWNNMDS_JOB_DTLS T1 WHERE T1.JOB_ID = 'PORESJOB' AND T1.JOB_STATUS = 'U' 
#update_ssbm_JobDtls_popres=UPDATE ##db-schema-name##.TWNNMDS_JOB_DTLS T1 SET T1.JOB_STATUS = :status WHERE T1.JOB_ID = 'PORESJOB'

#select applying for assistance members
select_new_SNAP_elig_members = SELECT  T1.ICI, T2.UPI, T3.SSN, T3.FRST_NM , T3.MID_NM, T3.LST_NM FROM  ##db-schema-name##.TWNPRGM_CASE_HSTRY T1, ##db-schema-name##.TWNCASE_MEMBER_HST T2, ##db-schema-name##.TWNPERSON T3 WHERE T1.PRGM_CASE_TYPE = 'FS' AND T1.PRGM_CASE_STS IN ('P', 'O') AND T1.RCRT_APL_DT BETWEEN '##db-begin-dt##' AND '##db-end-dt##' AND T1.PRD_BEG_DT = '##db-begin-dt##' AND T1.APPL_ACT_TYPE IN ('FA', 'RO', 'RC') AND T1.ICI = T2.ICI AND T2.UPI = T3.UPI AND T2.HH_LEFT_DT = '9999-12-31' AND T2.PRD_BEG_DT = '##db-begin-dt##'  AND T2.FS_ASST_IND = 'Y' AND NOT T2.FS_ELIG_CD IN ( '9', '3', ' ') AND NOT T2.ET_PRTCP_CD IN ( '07', '08') AND NOT T3.SSN LIKE '000%' AND NOT SSN LIKE '999%' AND T3.DOB <= CURRENT_DATE AND NOT T2.UPI IN (SELECT S1.UPI FROM  ##db-schema-name##.TWNUERND_INCM_DTL S1 WHERE S1.UERND_INC_TYPE_CD = '45' AND (S1.PRD_END_DT = '9999-12-31' OR S1.PRD_END_DT = '##db-end-dt##') AND PRD_BEG_DT <= '##db-begin-dt##' AND S1.UERND_INC_AMT > 0.0 AND NOT S1.UNE_INC_VERF_CD IN ('N', ' ', '?') AND  S1.MAINT_CD <> 'D') AND NOT T2.UPI IN (SELECT J1.UPI FROM ##db-schema-name##.TWNJOB_INCM_DTLS J1, ##db-schema-name##.TWNPAY_DTLS J2 WHERE (J1.PRD_END_DT = '9999-12-31' OR J1.PRD_END_DT = '##db-end-dt##') AND J1.UPI = J2.UPI AND J1.INCM_SQ_NMB = J2.INCM_SQ_NMB AND J1.PRD_BEG_DT <= '##db-begin-dt##' AND J1.PRD_BEG_DT = J2.PRD_BEG_DT AND NOT J1.JOB_INC_VRFD_CD IN ('N', ' ') AND J1.MAINT_CD <> 'D' AND J2.PAID_DT = (SELECT MAX(P2.PAID_DT) FROM ##db-schema-name##.TWNPAY_DTLS P2 WHERE P2.GRS_WGS_AMT > 0 AND P2.UPI = J2.UPI)) ORDER BY T1.ICI , T2.UPI
     select_NDNH_SNAP_Appls =  SELECT  T1.ICI, T2.UPI, T3.SSN, T3.FRST_NM , T3.MID_NM, T3.LST_NM FROM  ##db-schema-name##.TWNPRGM_CASE_HSTRY T1, ##db-schema-name##.TWNCASE_MEMBER_HST T2, ##db-schema-name##.TWNPERSON T3 WHERE T1.PRGM_CASE_TYPE = 'FS' AND T1.PRGM_CASE_STS IN ('P', 'O') AND T1.RCRT_APL_DT >= '##minRecert##'  AND T1.RCRT_APL_DT <= '##maxRecert##'  AND T1.PRD_BEG_DT = '##prdBeginDt##' AND T1.APPL_ACT_TYPE IN ('FA', 'RO') AND T1.ICI = T2.ICI AND T2.UPI = T3.UPI AND T2.HH_LEFT_DT = '9999-12-31' AND T2.PRD_END_DT = '9999-12-31' AND NOT T3.SSN LIKE '000%' AND NOT SSN LIKE '999%' UNION SELECT  T4.ICI, T2.UPI, T3.SSN, T3.FRST_NM , T3.MID_NM, T3.LST_NM FROM  ##db-schema-name##.TWNPRGM_CASE_HSTRY T1 , ##db-schema-name##.TWNCASE_MEMBER_HST T2 , ##db-schema-name##.TWNPERSON T3 , ##db-schema-name##.TWNREDET_RCRT_DTLS T4 WHERE T1.PRGM_CASE_TYPE = 'FS' AND T1.PRGM_CASE_STS IN ('P', 'O') AND T1.ICI = T4.ICI AND T2.ICI = T4.ICI AND T2.UPI = T3.UPI AND T4.PRGM_CASE_TYPE = 'FS' AND T4.NEXT_REDET_DT = '##redetDt##' AND T2.HH_LEFT_DT = '9999-12-31' AND T2.PRD_END_DT = '9999-12-31' AND NOT T3.SSN LIKE '000%' AND NOT SSN LIKE '999%'


##BATch QUERIES END